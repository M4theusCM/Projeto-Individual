<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GearUP - Perfil</title>
    <link rel="icon" href="../src/logo.png">
    <link rel="stylesheet" href="../styles/gearup.css">
    <script src="../js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="../js/poster.js"></script> -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Chewy&family=Figtree:ital,wght@0,300..900;1,300..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Chewy&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Chewy&family=Figtree:ital,wght@0,300..900;1,300..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    </style>
</head>

<body onload="validarSessao(), exibirPerfil(), buscarPosterUser()" style="display: flex;">
    <div class="container-principal" id="container_principal">
        <div class="menu-lateral">
            <div class="logo">
                <a href="./home.html">
                    <img src="../src/efeitos/gearup - efeito-claro.png" alt="GEARUP">
                </a>
            </div>
            <div class="area-links">
                <div class="links">
                    <a href="./home.html">
                        <img src="../src/icones/home-icon.png" class="menu-icons" alt="Home">
                        Pagina inicial
                    </a>
                </div>
                <div class="links">
                    <a href="./eventos.html">
                        <img src="../src/icones/evento-icon.png" class="menu-icons" alt="Calendario">
                        Eventos
                    </a>
                </div>
                <div class="links">
                    <a href="./jogos.html">
                        <img src="../src/icones/jogo-icon.png" class="menu-icons" alt="controle">
                        Jogos
                    </a>
                </div>
                <div class="links">
                    <a href="./filmes.html">
                        <img src="../src/icones/filme-icon.png" class="menu-icons" alt="Claclete">
                        Filmes
                    </a>
                </div>
                <div class="links">
                    <a href="./carros.html">
                        <img src="../src/icones/carro-icon.png" class="menu-icons" alt="Carros">
                        Carros
                    </a>
                </div>
            </div>
            <div class="area-sair">
                <div class="links">
                    <a href="./perfil.html" class="selecionado">
                        <img src="../src/perfils/perfil-5.png" alt="Perfil" id="perfil_img_menu" class="menu-img">
                        Perfil
                    </a>
                </div>
                <div class="links">
                    <button onclick="limparSessao()">
                        <img src="../src/icones/sair-icon.png" alt="Sair" class="menu-img">
                        Sair
                    </button>
                </div>
            </div>
        </div>
        <div class="container-perfil">
            <div class="banner">
                <div class="aba" onclick="exibirGeral()">
                    Geral
                </div>
                <div class="aba" onclick="exibirEstatisticas()">
                    Estatisticas
                </div>
            </div>
            <div id="perfil_geral">
                <div class="perfil">
                    <div class="img-perfil" id="img_usuario_perfil">
                    </div>
                    <div class="infos-perfil">
                        <div>
                            <h1 id="nickName_perfil"></h1>
                            <h3 id="nome_perfil"></h3>
                        </div>
                        <div>
                            <p>Descrição:</p>
                            <p id="desc_perfil">
                            </p>
                        </div>
                    </div>
                </div>
                <div class="container-postagens">
                    <div class="legendas">
                        <h2>Postagens:</h2>
                        <div class="add" onclick="adicionarPostagem()">
                            +
                        </div>
                    </div>
                    <div class="area-postagens" id="area_postagens_user">

                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>
    <div class="modal-add-poster" id="add_poster">
        <div class="fechar-modal">
            <div onclick="fecharModal()">
                <img src="../src/acessos/Arrow 1.png" alt="Sair">
            </div>
        </div>
        <div class="container-modal">
            <div class="infos-poster">
                <h1>Nova Postagem:</h1>
                <label class="linha-ipt">
                    Escolha a categoria:
                    <select id="select_categoria">
                        <option value="carro" selected>Carros</option>
                        <option value="evento">Eventos</option>
                        <option value="filme">Filmes</option>
                        <option value="jogo">Jogos</option>
                    </select>
                </label>

                <label class="linha-ipt">
                    Adicionar imagem:
                    <input type="file" id="ipt_img" onchange="atualizarPreview(1)">
                </label>

                <label class="linha-ipt">
                    Adicionar Legenda:
                    <textarea id="txt_legenda" maxlength="300" oninput="atualizarlegendaPreview()"></textarea>
                </label>

                <label class="linha-ipt">
                    Escolha o formato:
                    <select id="select_formato" onchange="formato()">
                        <option value="0" selected>Poster</option>
                        <option value="1">horizontal</option>
                        <option value="2">Quadrado</option>
                    </select>
                </label>
                <div class="enviar">
                    <button onclick="postar()">Postar</button>
                </div>
            </div>
            <div class="preview">
                <div class="card-preview" id="preview_formato_poster">
                    <div class="img">
                        <img src="../src/efeitos/gearup - efeito-claro.png" alt="img" id="preview_poster">
                    </div>
                    <div class="infos">
                        <div class="perfil">
                            <img src="" alt="" id="img_perfil_add_poster">
                            <p id="nickName_user_add_poster">User name</p>
                        </div>
                        <div class="desc">
                            <p id="desc_add_poter"></p>
                        </div>
                        <div class="estatisticas">
                            <div>
                                <img src="../src/icones/coracao.png" alt="">
                                <p>6000</p>
                                <span>Curtidas</span>
                            </div>
                            <div>
                                <img src="../src/icones/comentarios.png" alt="">
                                <p>6000</p>
                                <span>Comentarios</span>
                            </div>
                        </div>
                        <div class="comentarios">
                            <div class="comentarios-card">Comentario</div>
                            <div class="comentarios-card mg-0">Comentario</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


<!-- Funções -->
<script>
    function exibirGeral() {
        window.location = './perfil.html'
    }

    function exibirEstatisticas() {
        window.location = './dashboard.html'
    }



    // Modal


    function adicionarPostagem() {
        add_poster.style.display = 'flex'
        var img_perfil = sessionStorage.IMG_USUARIO;
        nickName_user_add_poster.innerHTML = sessionStorage.NICKNAME_USUARIO;
        img_perfil_add_poster.src = `
        ../src/perfils/${img_perfil}
    `

    }

    function fecharModal() {
        add_poster.style.display = 'none    '
    }


    function atualizarlegendaPreview() {
        var legenda = txt_legenda.value
        desc_add_poter.innerHTML = `${legenda}`
    }

    function atualizarPreview(valor) {
        if (valor == 1) {
            var file = ipt_img
            console.log(file.value)
            // if(file.value.includes('.mp4') == false){
            //     preview_video.style.display = `none`
            //     preview_poster.style.display = `block`
            // }else{
            //     preview_poster.style.display = `none`
            //     preview_video.style.display = `block`
            // }
            preview_poster.src = '../src/posters/Group 21.png'

        }
    }

    function formato() {
        var tipo = select_formato.value
        var poste = preview_formato_poster
        var horizontal = preview_formato_horizontal
        console.log(tipo)
        // if (tipo == 0) {
        //     poste.style.display = 'flex'
        //     horizontal.style.display = 'none'
        //     var img_perfil = sessionStorage.IMG_USUARIO;
        //     nickName_user_add_poster.innerHTML = sessionStorage.NICKNAME_USUARIO;
        //     img_perfil_add_poster.src = `
        //     ../src/perfils/${img_perfil}
        // `
        // } else if (tipo == 1) {
        //     poste.style.display = 'none'
        //     horizontal.style.display = 'flex'
        //     var img_perfil = sessionStorage.IMG_USUARIO;
        //     nickName_user_add_horizontal.innerHTML = sessionStorage.NICKNAME_USUARIO;
        //     img_perfil_add_horizontal.src = `
        //     ../src/perfils/${img_perfil}
        // `
        // } else {

        // }
    }

    function postar() {
        var idCriador = sessionStorage.ID_USUARIO
        var foto = ipt_img
        var legenda = txt_legenda.value
        var formato = select_formato.value
        var categoria = select_categoria.value
        var msg = `
        Dados do poster: \n
        ID Criador: ${idCriador} \n
        foto Valor: ${foto.files[0]} \n
        legenda: ${legenda} \n
        formato: ${formato} \n
        categoria: ${categoria} \n
        foto Nome: ${foto.value} \n
    `
        const formData = new FormData();
        formData.append('fkCriador', idCriador)
        formData.append('poster', foto.files[0])
        formData.append('legenda', legenda)
        formData.append('formato', formato)
        formData.append('tipo', categoria)

        fetch("/poster/cadastro", {
            method: "POST",
            body: formData
        })
            .then(res => {
                fecharModal()
                buscarPosterUser()
                // atualizações do banco

            })
            .catch(err => {
                console.log(err);
            })
    }

    function buscarPosterUser() {
        var fkCriador = sessionStorage.ID_USUARIO
        fetch(`/poster/posterUser/${fkCriador}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    // console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    posterUsuario(resposta)
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ poster: ${error.message}`);
            });
    }

    function posterUsuario(resposta) {
        var todosPosters = resposta
        var qtdPoster = todosPosters.length
        console.log(qtdPoster)
        var msg = ``
        for (var i = 0; i < qtdPoster; i++) {
            var posterAtual = todosPosters[i]
            var imagem = posterAtual.poster
            var qtdCurtidas = posterAtual.curtidas
            msg += `
        <div class="card-postagem">
            <img src="../src/posters/${imagem}" alt="">
            <div class="infos-postagem">
                Curtidas: ${qtdCurtidas}
            </div>
        </div>
    `
        }
        area_postagens_user.innerHTML = msg
    }

</script>


</html>